## Классификация с очень большим количеством классов

Пусть есть задача классификации, где различных меток много в сравнении с количеством объектов обучающей выборки (например, меток лишь в три раза меньше, чем объектов). В таком случае задача осложняется тем, что модель будет довольно редко угадывать правильную метку, и, значит, оптимизировать функции потерь, связанные с точными попаданиями, непрактично.

Предположим, что задача классификации с $n$ признаками и с $q$ классами, где $q$ большое в вышеописанном смысле, решается путем поиска матрицы $W$ размера $n \times q$, такой что близость объекта, признаковое описание которого задаётся вектором-столбцом $x$ длины $n$, к классу, закодированному вектором-столбцом $y$ длины $q$, где на позиции, номер которой равен номеру класса, стоит 1, а на остальных позициях стоят нули, вычисляется так:
$$\mathrm{sim}(x, y, W) = x^TWy.$$

Для обучения матрицы $W$ можно использовать функции потерь из следующего параметрического семейства, зависящего от параметров $\alpha_1$, ..., $\alpha_q$:
$$l(x_i, y_i, W) = \sum_{k = 1}^{\mathrm{rank}_W(y_i) - 1}\alpha_k,$$
где если верхний предел суммы равен 0, то сумма по пустому множеству индексов полагается равной нулю, а зависимость правой части от $x_i$ заложена в определении $\mathrm{rank}_W(y_i)$. Эта величина вычисляется как порядковый номер класса $y_i$ при ранжировании классов по невозрастанию $f(y) = \mathrm{sim}(x_i, y, W)$. В формулировке, учитывающей возможность совпадающих значений, это выглядит так:
$$\mathrm{rank}_W(y_i) = \#\!\left\{\left. y \in Q \: \right| \: x_i^TWy > x_i^TWy_i\right\} + 1,$$
где $Q$ — $q$-элементное множество классов, а решётка обозначает количество элементов в множестве.

Некоторые известные метрики оптимизируются функциями потерь из данного семейства:

* точность (accuracy) будет оптимизирована при $\alpha_1 = 1$ и $\alpha_k = 0$ для $k \in \{2, ..., q\}$;

* вероятность угадать с $m$ попыток будет оптимизирована при $\alpha_m$ = 1 и остальных $\alpha_k = 0$;

* средний ранг будет оптимизирован при всех $\alpha_k$, равных друг другу.
